{% extends 'base.html' %}

{% block header %}
    <h1>Dashboard, bitches</h1>
    <h2>Bitches, bitches</h2>
{% endblock header %}

{% block style %}
    .icons {
        float:left;
        clear:both;
    }
    #bad_pivot {
        float:left;
    }
    .step_icon {
        float:left;
        padding:4px;
        border:1px solid gray;
    }
    .current_step {
        float:left;
        clear:both;
    }
    .feed {
        float:left;
        clear:both;
    }
{% endblock style %}

{% block script %}


{% endblock script %}

{% block content %}

    <div class="jqmWindow" id="evidence_popup" style="overflow:auto;">
        <form action="/dashboard/evidence/" method="post">
            <input type="hidden" name="key" value="{{current_progress.key}}" />
            <br/>
            Results: <textarea name="evidence">{{current_progress.evidence}}</textarea>
            <a href="javascript:void(0);" onclick="$('#evidence_popup').jqmHide();">Actually I don't know enough yet</a>
            <input type="submit" value="Yeah!"/>
        </form>
    </div>

    <div class="icons">
        {% for step in steps %}
            <div class="step_icon">
                <a href="javascript:void(0);" onclick="click_step({{step.order}}, '{{step.key}}');">
                    <img src="{{ step.icon_big }}" />
                </a>
            </div>
        {% endfor %}
        <script>
            function click_step(step_num, step_key) {
                if (step_num <= {{current_progress.step.order}}) {
                    //pivot back to the same or earlier step
                    popup('/dashboard/pivot/?step=' + step_key);
                }
                else if (step_num == 1 + {{current_progress.step.order}}) {
                    //use the icon to move exactly one step forward
                    $("#save_and_forward").click();
                }
                else {
                    //not able to use icons to scoot ahead further than that
                    $("#bad_pivot").slideDown();
                }
            }
        </script>
    </div>

    <div id="bad_pivot" class="alert hidden">
        Before jumping this far ahead, you need to fill in beliefs for the preceding steps. Even if you aren't 100% sure, writing down what you're currently thinking will help you later.
        <a href="javascript:void(0);" class="medium" onclick="$('#bad_pivot').slideUp();">(Hide this message)</a>
    </div>

    <div class="current_step">
        <form id="hypothesis_form" action="/dashboard/hypothesis/" method="post">
            {{ current_progress.step.name }}
            <input type="hidden" name="key" value="{{current_progress.key}}" />
            <br/>
            Belief: <textarea name="hypothesis">{{current_progress.hypothesis}}</textarea>
            <br/>
            <input id="save_and_continue" type="submit" value="Save"/>
            <input id="save_and_forward" type="submit" value="Onward!"/>
        </form>

        <script>

            $("#hypothesis_form").submit( function(event) {
            });

            $("#save_and_forward").click( function(event) {
                if (event) {
                    event.preventDefault();
                }

                $.post($("#hypothesis_form").attr("action"),
                        $("#hypothesis_form").serialize()
                    );

                $("#evidence_popup").jqm();
                $("#evidence_popup").jqmShow();
            });

            $("#save_and_continue").click( function(event) {
                if (event) {
                    event.preventDefault();
                }

                $.post($("#hypothesis_form").attr("action"),
                        $("#hypothesis_form").serialize()
                    );
            });

        </script>
    </div>

    <div class="feed">
        {% for p in progress %}
            <p class="owned_feed_item">
                <img src="{{ p.step.icon_small }}" />
                <b>{{ p.step.name }}</b>
                {{p.hypothesis}}
                <br/>
                <i>{{p.evidence}}</i>
                <a class="edit_link hidden" href="javascript:void(0);" onclick="popup('/dashboard/edit_progress/?progress={{p.key}}');">(Edit)</a>
            </p>
        {% endfor %}

        <script>
            $(".owned_feed_item").mouseover(function(event) {
                $(this).children(".edit_link").show();
            });
            $(".owned_feed_item").mouseout(function(event) {
                $(this).children(".edit_link").hide();
            });
        </script>

    </div>
{% endblock content %}
