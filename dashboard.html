{% extends 'base.html' %}

{% block header %}
    <div class="bg_dark">

        <div class="title_bar">

            <h1>Traction Tracker</h1>
            <p>The <strong>Traction Tracker</strong> is designed to help start-ups and founders keep track of their early customer development activities.</p>

        </div>
    </div>
{% endblock header %}

{% block style %}
    textarea {
        border: 2px solid #cccccc;
        padding: 5px;
        font-family: Cabin Sketch, sans-serif;
        font-size: 24px;
        color: #666666;
        background-image: url(bg.gif);
        background-position: bottom right;
        background-repeat: no-repeat;
        width: 700px;
        height: 120px;
    }
    
    .icons {
        float:left;
        clear:both;
    }
    #bad_pivot {
        float:left;
    }
    .step_icon_area {
        float:left;
        margin:10px;
        position:relative;
    }
    .step_icon_area h4 {
        font-family:'Helvetica';
        width:120px;
        height:120px;
        text-align:center;
    }
    .step_icon {
        float:left;
        padding:10px;
        border:4px solid white;
        position:absolute;
        top:60px;
        left:20px;

        -moz-border-radius: 18px;
        -webkit-border-radius: 18px;
        -o-border-radius: 18px;
        -ms-border-radius: 18px;
        -khtml-border-radius: 18px;
        border-radius: 18px;
    }
    .step_icon:hover {
        border:4px solid #bbb;
    }
    .current_step {
        float:left;
        clear:both;
    }
    .feed {
        float:left;
        clear:both;
        margin-bottom: 100px;
    }
    .feeditem {
        padding:5px;
    }
    .textbox{
        float:left;
        width:60%;
    }
    .buttons{
        float:left;
        width:30%;
        height: 70px;
    }
    
{% endblock style %}

{% block script %}


{% endblock script %}

{% block content %}

    <div class="jqmWindow" id="evidence_popup" style="overflow:auto;">
    </div>

    <div class="icons">
        {% for step in steps %}
            <div class="step_icon_area">
                <h4> {{step.name }}</h4>
                <div class="step_icon">
                    <a href="javascript:void(0);" onclick="click_step({{step.order}}, '{{step.key}}');">
                        <img src="{{ step.icon_big }}" />
                    </a>
                </div>
            </div>
        {% endfor %}
        <script>
            function click_step(step_num, step_key) {
                if (step_num <= {{current_progress.step.order}}) {
                    //pivot back to the same or earlier step
                    popup('/dashboard/pivot/?step=' + step_key);
                }
                else if (step_num == 1 + {{current_progress.step.order}}) {
                    //use the icon to move exactly one step forward
                    $("#save_and_forward").click();
                }
                else {
                    //not able to use icons to scoot ahead further than that
                    $("#bad_pivot").slideDown();
                }
            }
        </script>
    </div>

    <div id="bad_pivot" class="alert hidden">
        Before jumping this far ahead, you need to fill in beliefs for the preceding steps. Even if you aren't 100% sure, writing down what you're currently thinking will help you later.
        <a href="javascript:void(0);" class="medium" onclick="$('#bad_pivot').slideUp();">(Hide this message)</a>
    </div>

    <div class="current_step">
        <form id="hypothesis_form" action="/dashboard/hypothesis/" method="post">
            <h3>{{ current_progress.step.name }}</h3>
            <input type="hidden" name="key" value="{{current_progress.key}}" />
            <br/>
            <p>How would you define your <b>{{ current_progress.step.name }}</b>?</p>
            
            <div class="textbox">
            <textarea name="hypothesis">{{current_progress.hypothesis}}</textarea>
            </div>
            <br/>
            
            <div class="buttons">
            <input id="save_and_continue" type="submit" value="Save" class="c2b"/>
            </div>
            </br>
            <div class="buttons">
            <input id="save_and_forward" type="submit" value="Onward!" class="c2a"/>
            </div>
        </form>

        <script>

            $("#hypothesis_form").submit( function(event) {
            });

            $("#save_and_forward").click( function(event) {
                if (event) {
                    event.preventDefault();
                }

                $.post($("#hypothesis_form").attr("action"),
                        $("#hypothesis_form").serialize()
                    );

                popup('/dashboard/add_evidence/?progress={{current_progress.key}}');
            });

            $("#save_and_continue").click( function(event) {
                if (event) {
                    event.preventDefault();
                }

                $.post($("#hypothesis_form").attr("action"),
                        $("#hypothesis_form").serialize()
                    );
            });

        </script>
    </div>
    
    <div class="feed">
    <p><h3>History</h3></p>
        {% for p in progress %}
            <div class="feeditem">
            <p class="owned_feed_item">
                <img style="padding-right:10px;" src="{{ p.step.icon_small }}" />
                <b>{{ p.company.name }}</b> defined their <b>{{ p.step.name }}</b> as <i>"{{p.hypothesis}}"</i>
                <br/>
                <p style="margin-left:200px;">and validated with evidence <i>"{{ p.evidence }}"</i> on <small>{{ p.timestamp|date:"l d F Y" }}</small></p>
                <a class="edit_link hidden" href="javascript:void(0);" onclick="popup('/dashboard/edit_progress/?progress={{p.key}}');">(Edit)</a>
            </p>
            </div>
        {% endfor %}

        <script>
            $(".owned_feed_item").mouseover(function(event) {
                $(this).children(".edit_link").show();
            });
            $(".owned_feed_item").mouseout(function(event) {
                $(this).children(".edit_link").hide();
            });
        </script>

    </div>
{% endblock content %}
